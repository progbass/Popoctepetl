define(["jquery","underscore","backbone","hammer"],function($,e,t,i){var n=t.Model.extend({defaults:{title:"",uri:"",thumb:"",state:""},select:function(e){this.set({state:e?"selected":""})}}),a=t.Collection.extend({model:n,initialize:function(){},select:function(e){this.selectedThumb()&&this.selectedThumb().select(!1),this.selected=e,this.selected.select(!0),this.trigger("thumbs:selected")},selectedThumb:function(){return this.selected},thumbAdd:function(e){var t=new d({model:e});t.render()},loadCompleteHandler:function(){$("section#galeria .thumbs_list li").first().click()}}),s=new a,l=new a,r=null,d=t.View.extend({tagName:"li",template:null,thumbsList:"section#galeria .thumbs_list",initialize:function(){this.template=e.template("<img src='<%= thumb %>' alt='<%= title %>' />")},render:function(){return $(this.el).html(this.template(this.model.toJSON())),$(this.thumbsList).append(this.el),this},events:{click:"selectThumb"},selectThumb:function(){return $(this.thumbsList+" li").removeClass("selected"),$(this.el).addClass("selected"),$(this.thumbsList+" li").each(function(e,t){return $(t).hasClass("selected")?void(actualIndex=e):void 0}),r.select(this.model),!1}}),o=t.View.extend({el:"section#galeria",lastTab:"",tabType:"",rendersInit:!1,floorsInit:!1,initialize:function(){e.bindAll(this,"manageTabs","configRenders","loadRender","displayList"),this.rendersInit=!1},render:function(){var e=this;if(this.manageTabs("renders"),window.location.hash){var t=window.location.hash;switch(t){case"#recorrido":t="recorrido";break;case"#renders":t="renders";break;case"#plantas":t="plantas";break;default:t=null}}},configRenders:function(){var e=this,t=$(e.el).find(".gallery");e.rendersInit=!0,s.on("add",s.thumbAdd),s.bind("thumbs:selected",e.loadRender),s.add([{title:"Render 1",uri:"img/renders/DEK-1.jpg",thumb:"img/renders/thumbs/DEK-1.jpg"},{title:"Render 2",uri:"img/renders/DEK-2.jpg",thumb:"img/renders/thumbs/DEK-2.jpg"},{title:"Render 3",uri:"img/renders/DEK-3.jpg",thumb:"img/renders/thumbs/DEK-3.jpg"},{title:"Render 1",uri:"img/renders/Dek-1b.jpg",thumb:"img/renders/thumbs/Dek-1b.jpg"},{title:"Render 4",uri:"img/renders/DEK-4.jpg",thumb:"img/renders/thumbs/DEK-4.jpg"},{title:"Render 2",uri:"img/renders/Dek-2b.jpg",thumb:"img/renders/thumbs/Dek-2b.jpg"},{title:"Render 3",uri:"img/renders/Dek-3b.jpg",thumb:"img/renders/thumbs/Dek-3b.jpg"}]),s.loadCompleteHandler(),i.Swipe({velocity:8,threshold:18});var n=new i(this.el);n.on("swipe",function(e){2==e.direction?(actualIndex++,actualIndex=actualIndex>$("section#galeria .thumbs_list li").length?0:actualIndex):4==e.direction&&(actualIndex--,actualIndex=actualIndex<0?$("section#galeria .thumbs_list li").length:actualIndex),$("section#galeria .thumbs_list li:eq("+actualIndex+")").click()})},configFloors:function(){var e=this,t=$(e.el).find(".gallery");e.floorsInit=!0,l.on("add",l.thumbAdd),l.bind("thumbs:selected",e.loadRender),l.add([{title:"Corte Transversal",uri:"img/floors/DEK_plantas_website_cortetransversal.png",thumb:"img/floors/thumbs/DEK_plantas_website_cortetransversal.jpg"},{title:"Sotano",uri:"img/floors/DEK_plantas_website_estacionamiento.png",thumb:"img/floors/thumbs/DEK_plantas_website_estacionamiento.jpg"},{title:"Planta Baja",uri:"img/floors/DEK_plantas_website_plantabaja.png",thumb:"img/floors/thumbs/DEK_plantas_website_plantabaja.jpg"},{title:"Planta Tipo",uri:"img/floors/DEK_plantas_website_plantatipo.png",thumb:"img/floors/thumbs/DEK_plantas_website_plantatipo.jpg"},{title:"Roof Garden",uri:"img/floors/DEK_plantas_website-roofgarden.png",thumb:"img/floors/thumbs/DEK_plantas_website-roofgarden.jpg"}]),l.loadCompleteHandler(),i.Swipe({velocity:8,threshold:18});var n=new i(this.el);n.on("swipe",function(e){2==e.direction?(actualIndex++,actualIndex=actualIndex>$("section#galeria .thumbs_list li").length?0:actualIndex):4==e.direction&&(actualIndex--,actualIndex=actualIndex<0?$("section#galeria .thumbs_list li").length:actualIndex),$("section#galeria .thumbs_list li:eq("+actualIndex+")").click()})},loadRender:function(){var e=$(this.el).find(".photo_holder"),t=new Image;t.src=r.selectedThumb().attributes.uri,t.alt=r.selectedThumb().attributes.title,t.onload=function(){e.removeClass("loading")},e.addClass("loading"),e.html(t),e.find("img").hide().fadeIn(600)},displayList:function(){r.each(function(e){r.thumbAdd(e)}),$("section#galeria .thumbs_list li").first().click()},manageTabs:function(e){var t=this,i="";if(t.lastTab==e)return!1;switch($(t.el).find("a.tab").removeClass("active"),$(t.el).find("a[href='#"+e+"']").addClass("active"),e){case"recorrido":i="recorrido.html";break;case"renders":i="renders.html";break;case"plantas":i="renders.html";break;default:i="recorrido.html"}$(t.el).find(".content_loader").load(i,function(){"renders"==e&&(r=s,t.rendersInit?t.displayList():t.configRenders()),"plantas"==e&&(r=l,t.floorsInit?t.displayList():t.configFloors())}),t.lastTab=e},events:{"click a.tab":function(e){return this.tabType=$(e.currentTarget).attr("href").replace("#",""),this.manageTabs(this.tabType),!1}}});return o});
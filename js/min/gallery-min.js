define(["jquery","underscore","backbone","hammer"],function($,e,t,i){var l=function(l,n,s){var c,h,d,o,r,u=function(e,t,i){c=t,h=i,d=new m,d.url=e,d.on("add",b),d.fetch({add:!0,success:v}),frontview=new p({model:d,el:c+" .photo_holder"})},a=t.Model.extend({defaults:{title:"",uri:"",thumb:"",state:""},select:function(e){this.set({state:e?"selected":""})}}),m=t.Collection.extend({model:a,initialize:function(){},select:function(e){this.selectedThumb()&&this.selectedThumb().select(!1),this.selected=e,this.selected.select(!0),this.trigger("thumbs:selected")},selectedThumb:function(){return this.selected}}),f=t.View.extend({tagName:"li",template:null,events:{},initialize:function(){this.template=e.template("<img src='<%= thumb %>' alt='<%= title %>' />")},render:function(){return $(this.el).html(this.template(this.model.toJSON())),this},events:{click:"selectThumb"},selectThumb:function(){$(h+" li").removeClass("selected"),$(this.el).addClass("selected"),$(h+" li").each(function(e,t){return $(t).hasClass("selected")?void(r=e):void 0}),d.select(this.model)}}),p=t.View.extend({template:null,initialize:function(){this.template=e.template("<li><span><%= title %></span><img src='<%= uri %>' alt='<%= title %>' /></li>"),this.model.bind("thumbs:selected",this.render,this),i.Swipe({velocity:8,threshold:18});var t=new i(this.el);t.on("swipe",function(e){2==e.direction?(r++,r=r>$(h+" li").length?0:r):4==e.direction&&(r--,r=0>r?$(h+" li").length:r),$(h+" li:eq("+r+")").click()}),$(c+" nav a").click(function(){return $(this).hasClass("prev")?(r--,r=0>r?$(h+" li").length:r):(r++,r=r>$(h+" li").length?0:r),$(h+" li:eq("+r+")").click(),!1})},render:function(){return $(this.el).html(this.template(this.model.selectedThumb().toJSON())),$(this.el).hide().fadeIn(600),this},onSwipe:function(){alert("swipe yo yo!")}}),b=function(e){var t=new f({model:e});t.render(),$(h).append(t.el)},v=function(){$(h+" li").first().click()};u(l,n,s)};return l});